<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/Ircam-RnD/binauralFIR" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">audio</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/audio/BinauralPanner.js~BinauralPanner.html">BinauralPanner</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/audio/Source.js~Source.html">Source</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createDiracBuffer">createDiracBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createNoiseBuffer">createNoiseBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dBToLin">dBToLin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-resampleFloat32Array">resampleFloat32Array</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">common</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-almostEquals">almostEquals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-almostEqualsModulo">almostEqualsModulo</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">geometry</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distance">distance</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-distanceSquared">distanceSquared</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-glToSofaCartesian">glToSofaCartesian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-glToSofaSpherical">glToSofaSpherical</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-glToTyped">glToTyped</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sofaCartesianToGl">sofaCartesianToGl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sofaCartesianToSofaSpherical">sofaCartesianToSofaSpherical</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sofaSphericalToGl">sofaSphericalToGl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sofaSphericalToSofaCartesian">sofaSphericalToSofaCartesian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typedToGl">typedToGl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-typedToSofaCartesian">typedToSofaCartesian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-atan2">atan2</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cos">cos</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fromRadian">fromRadian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sin">sin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toRadian">toRadian</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fromRadianFactor">fromRadianFactor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-toRadianFactor">toRadianFactor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-coordinates">coordinates</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-coordinatesType">coordinatesType</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">sofa</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/sofa/HrtfSet.js~HrtfSet.html">HrtfSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/sofa/ServerDataBase.js~ServerDataBase.html">ServerDataBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseDataSet">parseDataSet</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-conformSofaType">conformSofaType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseSofa">parseSofa</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-HrtfSet.nearestType">HrtfSet.nearestType</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><h1 id="binaural">Binaural</h1>
<p>This library permits to render sources in three-dimensional space with
binaural audio.</p>
<p>This library provides an access to a server, in order to load a set of
<a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a>. The set of filters applies to any number of sources, given their
position, and a listener.</p>
<p>This library is compatible with the <a href="https://webaudio.github.io/web-audio-api/">Web Audio API</a>. The novelty of this
library is that it permits to use a custom <a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a> dataset (see
<a href="http://wac.ircam.fr/pdf/demo/wac15_submission_16.pdf">T. Carpentier</a>).</p>
<p>It is possible to use it without a server, with a direct URL to an <a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a>
set.</p>
<h2 id="documentation">Documentation</h2>
<p>You can consult the <a href="http://cdn.rawgit.com/Ircam-RnD/binauralFIR/next/doc/index.html">API documentation</a> for the complete documentation.</p>
<h3 id="binauralpanner">BinauralPanner</h3>
<p>A <code>BinauralPanner</code> is a panner for use with the <a href="https://webaudio.github.io/web-audio-api/">Web Audio API</a>. It
spatialises multiple audio sources, given a set of head-related transfer
functions <a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a>s, and a listener.</p>
<h3 id="serverdatabase">ServerDataBase</h3>
<p><strong>The public server that hosts a database of individual <a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a>s is available
for beta-testers only and will open to public in 2016.</strong></p>
<p>The <code>ServerDataBase</code> retrieves a catalogue from a <a href="http://www.aes.org/publications/standards/search.cfm?docID=99">SOFA</a> server. From the
catalogue, it get URLs matching optional filters: data-base, sample-rate,
and any free pattern.</p>
<h3 id="hrtf-dataset">HRTF dataset</h3>
<p>You can use any <a href="http://en.wikipedia.org/wiki/Head-related_transfer_function">HRTF</a> data-set that follows the <a href="http://www.aes.org/publications/standards/search.cfm?docID=99">SOFA</a> standard, in JSON
format, using finite impulse responses (FIR). Second-order sections (SOS)
are not supported, yet. See the <a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/examples/hrtf/">examples HRTF directory</a> for a few samples.</p>
<h3 id="coordinates-system-types">Coordinates system types</h3>
<p>See the files in the geometry, for conversions:</p>
<ul>
<li><a href="http://www.aes.org/publications/standards/search.cfm?docID=99">SOFA</a> and openGL conventions</li>
<li>cartesian and spherical coordinates</li>
<li>radian and degree angles</li>
</ul>
<h2 id="examples">Examples</h2>
<p>Please see the <a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/examples/">examples directory</a> for complete code, and the <a href="http://cdn.rawgit.com/Ircam-RnD/binauralFIR/next/examples/index.html">examples online</a>.</p>
<p>See also the <a href="http://cdn.rawgit.com/Ircam-RnD/binauralFIR/next/doc/index.html">API documentation</a> for the complete options.</p>
<h3 id="binauralpanner">BinauralPanner</h3>
<p>Given an audio element, and a global binaural module,</p>
<pre><code class="lang-html"><code class="source-code prettyprint">&lt;html&gt;
    &lt;head&gt;
        &lt;script src=&quot;../binaural.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;audio id=&quot;source&quot; src=&quot;./snd/breakbeat.wav&quot; controls loop&gt;&lt;/audio&gt;
    &lt;/body&gt;
&lt;/html&gt;</code>
</code></pre>
<p>create a source audio node,</p>
<pre><code class="lang-js"><code class="source-code prettyprint">var audioContext = new AudioContext();
var $mediaElement = document.querySelector(&apos;#source&apos;);
var player = audioContext.createMediaElementSource($mediaElement);</code>
</code></pre>
<p>instantiate a <code>BinauralPanner</code> and connect it.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">var binauralPanner = new binaural.audio.BinauralPanner({
    audioContext,
    crossfadeDuration: 0.05, // in seconds
    positionsType: &apos;sofaSpherical&apos;, // [azimuth, elevation, distance]
    sourceCount: 1,
    sourcePositions: [ [0, 0, 1] ], // initial position
});
binauralPanner.connectOutputs(audioContext.destination);
binauralPanner.connectInputByIndex(0, player);</code>
</code></pre>
<p>Load an HRTF set (this returns a promise).</p>
<pre><code class="lang-js"><code class="source-code prettyprint">binauralPanner.loadHrtfSet(url)
    .then(function () {
        console.log(&apos;loaded&apos;);
    })
    .catch(function (error) {
        console.log(&apos;Error while loading &apos; + url
                    + error.message);
    });</code>
</code></pre>
<p>Then, any source can move:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">$azimuth.on(&quot;input&quot;, function(event) {
    // get current position
    var position = binauralPanner.getSourcePositionByIndex(0);

    // update azimuth
    position[0] = event.target.value;
    binauralPanner.setSourcePositionByIndex(0, position);

    // update filters
    window.requestAnimationFrame(function () {
        binauralPanner.update();
    });
}</code>
</code></pre>
<p>Note that a call to the <code>update</code> method actually updates the filters.</p>
<h3 id="serverdatabase">ServerDataBase</h3>
<p>Instantiate a <code>ServerDataBase</code></p>
<pre><code class="lang-js"><code class="source-code prettyprint">var serverDataBase = new binaural.sofa.ServerDataBase();</code>
</code></pre>
<p>and load the catalogue from the server. This returns a promise.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">var catalogLoaded = serverDataBase.loadCatalogue();</code>
</code></pre>
<p>Find URLs with <code>HRIR</code> convention, <code>COMPENSATED</code> equalisation, and a
sample-rate matching those of the audio context.</p>
<pre><code class="lang-js"><code class="source-code prettyprint">var urlsFound = catalogLoaded.then(function () {
    var urls = serverDataBase.getUrls({
        convention: &apos;HRIR&apos;,
        equalisation: &apos;COMPENSATED&apos;,
        sampleRate: audioContext.sampleRate,
    });
    return urls;
})
.catch(function(error) {
    console.log(&apos;Error accessing HRTF server. &apos; + error.message);
});</code>
</code></pre>
<p>Then, a <code>BinauralPanner</code> can load one of these URLs</p>
<pre><code class="lang-js"><code class="source-code prettyprint">urlsFound.then(function(urls) {
    binauralPanner.loadHrtfSet(urls[0])
        .then(function () {
            console.log(&apos;loaded&apos;);
        })
        .catch(function (error) {
            console.log(&apos;Error while loading &apos; + url
                + error.message);
        });
});</code>
</code></pre>
<h2 id="issues">Issues</h2>
<ul>
<li>re-sampling is broken on full set (Chrome 48 issue): too many parallel
audio contexts?</li>
<li>no HTTPS on SOFA server, yet (mixed content blocked)</li>
<li>clicks on Firefox 44-45 (during update of <code>convolver.buffer</code>)</li>
<li>in documentation, links to BinauralPanner methods are broken (esdoc)</li>
</ul>
<h2 id="to-do">To do</h2>
<ul>
<li>Spat coordinates</li>
<li>attenuation with distance</li>
<li>dry/wet outputs for (shared) reverberation</li>
<li>relative view for the listener</li>
</ul>
<h2 id="developers">Developers</h2>
<p>The source code is in the <a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/src">src directory</a>, in <a href="https://babeljs.io/docs/learn-es2015/">ES2015</a> standard. <code>npm run
compile</code> with <a href="https://babeljs.io/">Babel</a> to the <a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/dist/">dist directory</a>. Note that there is a
<a href="./.babelrc">.babelrc</a> file. <code>npm run bundle</code> runs the linters, the tests,
generates the documentation, and compiles the code.</p>
<p>Be sure to commit the distribution files and the documentation for any
release, and tag it.</p>
<h3 id="style">Style</h3>
<p><code>npm run lint</code> to check that the code conforms with <a href="./.eslintrc">.eslintrc</a> and
<a href="./.jscsrc">.jscsrc</a> files. The rules derives from <a href="https://github.com/airbnb/javascript/">AirBnB</a> with these
major points:</p>
<ul>
<li><a href="https://babeljs.io/docs/learn-es2015/">ES2015</a></li>
<li>no <code>&apos;strict&apos;</code> globally (already there via babel)</li>
<li>enforce curly braces (<code>if</code>, <code>for</code>, etc.)</li>
<li>allow spaces and new lines, with fewer requirements: use them for clarity</li>
</ul>
<h3 id="test">Test</h3>
<p>For any function or method, there is at least a test. The hierarchy in the
<a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/test">test directory</a> is the same as in the <a href="https://github.com/Ircam-RnD/binauralFIR/tree/next/src">src directory</a>.</p>
<ul>
<li><code>npm run test</code> for all automated tests</li>
<li><code>npm run test-listen</code> for supervised listening tests. The test files must
end with <code>_listen.js</code></li>
<li><code>npm run test-issues</code> for unsolved issues. The issues may depend on the
host: operating system, user-agent, sound-device, sample-rate, etc. The
test files must end with <code>_issues.js</code></li>
</ul>
<h3 id="documentation">Documentation</h3>
<p>Document any public function and method with <a href="http://usejsdoc.org/">JSDoc</a>, and generate the HTML
pages with <code>npm run doc</code>. At this point, neither
<a href="https://www.npmjs.com/package/jsdoc">jsdoc</a> nor
<a href="https://www.npmjs.com/package/esdoc">esdoc</a> gives perfect
transcription. (See the <a href="./jsdoc.json">jsdoc.json</a> and
<a href="./esdoc.json">esdoc.json</a> files.)</p>
<h2 id="license">License</h2>
<p>This module is released under the <a href="http://opensource.org/licenses/BSD-3-Clause">BSD-3-Clause</a> license.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>This research was developped by both <a href="http://recherche.ircam.fr/equipes/salles/">Acoustic And Cognitive Spaces</a> and
<a href="http://apm.ircam.fr/">Analysis of Musical Practices</a> IRCAM research teams. A previous version
was part of the WAVE project, funded by ANR (French National Research
Agency). The current version, supporting multiple sources and a listener,
the SOFA standard, and the access to a server, is part of the <a href="http://cosima.ircam.fr/">CoSiMa</a>
project, funded by ANR.</p>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
